<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="My Life RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="My Life Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">虚拟机（一） | My Life</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://7213.github.io/docs/编译原理/虚拟机"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="虚拟机（一） | My Life"><meta data-react-helmet="true" name="description" content="当我们有了 AST 后，我们就有了多种选择来决定如何执行 AST 。"><meta data-react-helmet="true" property="og:description" content="当我们有了 AST 后，我们就有了多种选择来决定如何执行 AST 。"><link data-react-helmet="true" rel="shortcut icon" href="/img/air.ico"><link data-react-helmet="true" rel="canonical" href="https://7213.github.io/docs/编译原理/虚拟机"><link data-react-helmet="true" rel="alternate" href="https://7213.github.io/docs/编译原理/虚拟机" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://7213.github.io/docs/编译原理/虚拟机" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.fe77ab2a.css">
<link rel="preload" href="/assets/js/runtime~main.76f2abf5.js" as="script">
<link rel="preload" href="/assets/js/main.653bb773.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title">7113的太空历险</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">技术探险</a><a class="navbar__item navbar__link" href="/blog">杂谈生活</a></div><div class="navbar__items navbar__items--right"><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">2022-2025的计划</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">数学</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">编译原理</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/编译原理/虚拟机">虚拟机（一）</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">一种JS Parser：TDOP</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">重返javascript</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">rust笔记</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>虚拟机（一）</h1></header><p>当我们有了 AST 后，我们就有了多种选择来决定如何执行 AST 。</p><ul><li>一种办法是编写解释器来对 AST 求值</li><li>二来可以将 AST 翻译成一个自定义的字节码，用我们自定义的虚拟机来执行</li><li>三来可以将 AST 直接翻译成不同机器的机器码</li></ul><p>这里让我们看看虚拟机的办法，首先我们先来了解什么是虚拟机？虚拟机的本质是用软件来模拟计算机的执行过程，所以想要了解虚拟机需要先了解计算机大致是如何工作的。</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="物理机和操作系统">物理机和操作系统<a aria-hidden="true" class="hash-link" href="#物理机和操作系统" title="Direct link to heading">​</a></h2><p>现在假设我们有一个名为 plus 的可执行文件，它的源码如下，让我们看看它是怎么run起来的呢？</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">function main() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 19 + 3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>对应的汇编指令假设如下：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">mov ax,013H</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mov bx,003H</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">add ax,bx</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>对应的机器码
<code>BB 23 01 BB 03 00 89 D8 01 D8</code></p><p>经过链接后，让其变为可执行文件，它的大概形如：<br>
<img alt="img_2.png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARwAAACiCAYAAACTQ3JRAAAYcUlEQVR4Xu2dCfwkRXXHXxQURYMXiERkNZjggSiIKBCXRGJIDJ4xHmhY4wExUYJnMAiIKBKTGBcFJciCgsYDFAEFg0BQgqhBDIlKiC4R8VYUPEA8Ur9/1dt+XVMz093TM9OP/X0/n99n/1Ove6Zn3+s3Va+ru0QIIWSRrF279leUf+V+JWSQ5IFL+VTuV0IGCQPWN/QfcQUD1jf0H3EFA9Y39B9xBQPWN/QfcQUD1jf0H3EFA9Y39B9xBQPWN/QfcQUD1jf0H3EFA9Y39B9xBQPWN/QfcQUD1jf0H3EFA9Y39B9xRYeAXRV0YtDLg7asm4q8Iuifg/YP2izo8KAH1bbozkMlvjd078w2jeODjgy6R25I7BT0qqCjc8MMXBZ0adAxuaErHfxHyPLoELBPD8L20D0zW4mLJW77jqCD09/XSHnf3wl68QQdWG26whOkOhYkiKbcPehmifudldmU10q0/zxo68w2DWy/faYnSnWsby/YVdtJCzr4j5Dl0SFg8euM7b+WG8ZgE86vBb07vV5nN0r8g1QnZUk/rDZdoWvCOUiq/Z6U2ZStgn4qcRv05trwHhk99qa6SlrQwX+ELI+GAbuJxJMP+oXEE+OXpg36pMRk9J1Mt6Ttb0qvr0+vf5Be30EqNOGgV4ETT4Xt0N5XwrlS4j7XBZ0qo8eswnFgO/SGcptqlYxiEw7+v5qICYfc+mkYsEg4ekKM06eD3lpon6Y7SoUmHJzIFtRS0K4JZ/OgO0l9ePeo1GaF4855hFT7vCboDPO6i+4no2jCQRJuyrES92HCIbdeGgYshkKooRwn1Yl2eGpTPS1or6wN+nLa/lMFG2STQtOEc2N6PU3PTttbTpdoQ+8FhebHyegxtdEWMoomnO8Gva+hrk77MOGQWy8tA1YLqUgidwvaRkav8twm0yck7nNSwZajCefHEq9uqc5N7W0TzrPS9srjje2zme23JSafprJDwRzWcAgp0TJgr5B4Uvx90AfS3xcZO07E/ASaJAyJLE2Lxk8NembQm4wNiQltB5i2/dL24M5B1xobelyW1xlbE90n7lZEE84XgvZtqLPTPkw45NZLi4BFD0BPtj1kvgkHhWbUhFS4Iob2vGi8JrVD26Y2XG7XNiQgRWskqjzhHCqxoN1Uk+b9aMJB8sAxNNF5Zp/GtPAfIcunRcBqMviGxOHQtITz8KBdgi5Pr89MryG93Dwu4Uyr4SgvSe2QFp/vZdqekdoeLPUrQVCecPqEQypCSrQI2M9IPCG+F3RB0LfTa/za4/V7pZ5wtEZj5+EoqNGgbdaEc1RqxyV3BT0PPQYUsgFmRCPh4JhRu4EtTziHBH2rhZr0cLAdvncTYfjFhENu3bQI2LVSncgloT5iE85lEk/qG9JrnOx4DWlvY1zCQWKx9Y13mXaLXjXDfBoFtRU9hqeY9vMlzmT+ULLlCWceNRxeFifE0iJgd5Z4lUr1RYknyP+l1y+T/mo445QnnH9L7eh9KZgXo9tjYqCC2xnAuISzo8TjaSodwpXgxD9CSswQsNNqOLiShB6GDhU+nl5DN6e2cQkHs5gxdFP9JLXbhLOpaUfvQLHFbRxPTinh3C7oT1tqt5U9y7CGQ0iJGQLWJpxtJSaPJ6c2aN41HBSl9bO0OAweZNr/wLQrpYSDOUW6T1OdtrJnGcxNwpCrJAzrnldoV02qDY0wg/8IWTwtAha9ANzN/FiJc13+W+KJh96InoS4vKt/n5GE2bZ4fY1p03uU2iYcTPjbK+hhEodw+lm2ngKbtj/atCvTEg6+Tz7cKQ19SgkHkwFfEfR7Em+/wP8VbveAMAR7TNCPJF6lK/WQHhH0OYm9w0a08B8hy6dhwN5eqpswxwnDGySQvH2SmiSc+0o8ue1+L5TqVoAvV5uusHtqh3bNbGBawllj2kv8u8TtSgnHPoICie9vzGt8Bp4HpNMEML0APUPLpcmGYeQ2ma1IQ/8RMgxaBKxOvoPQQ7kp/f0liSc5ekC2hnOQxHuNkBDw2t5L9bPUNi7hYMiFK1NfTa9znW7+Pnhlz4rfNzYMr3LmmXDeKdG2Pr3OEw5YJTGhoO0UiTOgzwl6jsRej85RwkTAqbTwHyHLp0XA4r4k1GhwEqPHM61o3KaGgytIOJH1ZMuF3hOm/h8ocfh0SWpHTQcnrAX1Ed0PkwBzpiWcF0mswYwTrohhuzzh4LNwnLDhlgtQSjgAQy1c2UPh+4FmG9Sc7FBR5xGNpYX/CFk+MwRs14SDIZIOz2wP55rUBqEHhRMbPR68p71R8oi0DYR7uiwYovxnsiF54YTOmZZwmipPOMeldtSAtGeFB3fp9s+X+DlWW0t8+p9u8xsS757X+hjmNpW+wwZm8B8hi2eGgO2ScDARDjOTdRvccqC8ROLkO/zK570W5Y+kKlKjhrOFxB4CkguK07aAjVnIJeaVcPR98f+i2Ctp0/S/aR+A/wPMb/pd01ZkBv8RsnhmCNguCecEY/+PZG8DisCYsYwh2UNMu70LHMOacyU+gKvEtISD4RC+xzjphMc84QDcnW6PC+AB7zbJ5kJvDjeo7qM7JCZNLNzADP4jZPHMELCY+4IeCWomym9KrFtAeGgXWC1xsh9u2txBYlEWd5t3BZ9hZxADTPbbO2hPifWlSewf9EaJtRoFQ7bDknYy7SX+XOJ2qGc1BcMizIAu6dfNdq2ZwX+ELB4GrG/oP+IKBqxv6D/iCgasb+g/4goGrG/oP+IKBqxv6D/iCgasb+g/4goGrG/oP+INBCvlX4S4IA9cyqcIGT7skvuG/iOuYMD6hv4jrmDA+ob+I65gwPqG/iM9gKcl6M3E22W2abTblwHrG/qP9ICuYAvhUcJtaLcvA9Y39B/pgXZJo067fRmwvqH/SA+0Sxp12u3LgPUN/Ud6oF3SqNNuXwasbzr4b7XE1S8g/K1tWEXigxKf4qjtYEuJT2l8t8QljA8Puqex52wi8QmPR0pc9HCdxOdVl9YI+xOpjiV/iiPAkxjVrit2TGJzqW+P11hp43kSl/A5WeKaZndN2wM8JRInzVkSH4T/eGMrgadL/qXEh9+fGXSMxBVN8udwr5L6seAB+TlYhVXtbZ4gicfnrgl6m8RjwDJDWFYJT7FctWGrUfDUTTzYH48HfovEp3beVpoljVn2regQsGRAdPAfnrGsAYK/jzCvVVhhFMkAq09gwb7cjtVDS6uaYvE/rByab28/Dw++V95sbDfI6ONhcfKrHWuZ2aV2SuCktp+3Wqp10aywJBGSkf18K5zE+ohcBeuuHSHVmmq58ND7fXRjiYlaV5iFsHpsji6KCGGFkiYgMeP/P/981c0S1zjLOVTqiwyozpb4HG99XUoas+xbp0PALhr8yq0yQlZdFkM6lhU6+M8mHJzk+BfBZE8OCIGrC/blNugrEnszym9JtTii6ptSrdWlwuqi+oB9u0oq9IepXcGD99X2kcxWIk84+v1Kq8Z+3fxd+n54drVlnbFBSDw4wfL97Hf4mGm/zLQD9NbsfljmeRqPkvp3uU5irw29LfvDAH8i4SmHGJsKx67J0y5hnSeNWfYdpUPALhosDWO/bL487iIZ0rGs0MF/NuFA+JXCEAm/+KXgwsJ8OjTBkMvaMLxQLjTtCLydUzt6BhiC2MDEsAagF4GegbZjiKAgKX3L2NYY2zjyhIOk+SSJ77WDxKV4rP0LQQ+QmDiRKOxCjBg+Kliux+6H9dB0VY1VUu+prDc2JC1tRxKwCzP+lbFhnyYcK9U+35f6yiR2QUVI13xDj9KuGvJ5qYZdOE4Mj+x+NmnMsm+ZDgG7aIZ0kg/pWFbo4D+bcJAE7DAFCQCrmaodwyPLQ40N0roLkottx/9TzslS2e0aXH9n2vGLrUMZrOyh7Ugcd0ntk8gTDrr7FtSSSsev6BJCkP3uHzbtWNInB5Pe7JADNR2AWhGOXdsPSO3gX0076kBNQJ1Haz57ZzasRW+/G5bUBvhM247Em4PlutVuk8Ys+5bpELCLZkgn+ZCOZYUO/rMJ5+rMBmwAnZTZsCSz/f7PTO1/ZtpQXygNNfeVahskOu0FoBhp31OHFjYR4YRvQp5w9qubV371rT0vQtsexP+Ydgwftf2Vpt2CddZ0m6NNO4rR2q7DQvQcbC1Ie4NtwHs8UmLx9iipHyOkCcfWWK5MbTlvkGobmzRm2bdMh4BdFPeXmMnzbhuKb2hfXW26gYcHHSyxYg+hK79TbYvYvX6uVL8UOFks6F5jWV6140TpciwLoYP/bML5bGYDuswwhBPQgjW07PfXhIMTTNvsiWrJe0coMCtIfNqOq2TgKtOmPYZp5Annj+tmeaqxQUigln80Nv0eqNvZ3ot+5xzbO0LRWUHS03bUuDAMQpLQtlLSHwd6f4jNK6RcxLXShGOPa1wdDFe3dBubNGbZt0yHgF0U1lElnVhtuvJr+dbCNiqcENpVB6i6W7stEL7atMOpe0m7Y1koHfw3j4SDhQ+17drUloOCp90XwxAFl+S1/b8kdt31Neoq+SXnccwj4eAHyha+8WNV4jyptsEleAXHbvfH1b9/Ma81wTbh9VI/fqwCe0LQSyX+sNrhmyYc9FK17eLUloNem25jk8Ys+5bpELCLAuPr9RKvdNj/ZAQ02tGVA0gkn8i2QbHRFgChk9P2AF1+XC1RG+oWGB5hmV7rNKzQCZoey8Lp4L95JBw7XMIVHxSYc2w9AEs12x+ABxsbhJNI/8ZcnqbMI+EAO1zCpfQcJCWcbLpNPuzSZbGh90q9ToaYawKK7/YqoMamgmOwhXlNOOiFaxsKzZuldsupUm1jk8Ys+5bpELCLZlrd5AXGhqLjbqkdY1z8p9t97fBqe6nPZ0ARzwYWuq1wsmXasSycDv6bR8LB1Rd7MqDHYsGwBP+faj+/bl4BPRu12+GCXm1pwrwSzlrT/h0ZnfiI/wf7vnvWzSu9GrXZ74Z6WVN2lPpn7F43r9RzrF0TTt6zxFVHC+pY+AFQu00as+xbpkPALpppJzl6GWrLi4TgEqnsyMaWvAqvQu8Ik95yph3Lwungv3kkHHB4Zjs+6IkShyCYaKftt0j5V90OZVUIZlySb8q8Eg56bEg0akN9CZe18f4Y5theMXowOUi4N8ro93uN3WgKuEpn98VwB/Ug/Cgi2diaF4RhlnKBaUfCQwJFrxT1l/XGBuVJY5Z9R+kQsItm0kmOgLE2dMVxidHqQmPHf1DOOVJ/D+ig2hYVk45lKXTw37wSDgL/wsyeC8MteyJYUJjPt39/bYvpzCvhACRP+2teEmoqW+sOGafJ6PalH7VJ5LGKBIAErn/bXuaRaR+Ann1eDrDCpET9O08as+w7SoeAXTSTTvJHZ7ZpQsDk7Cr1bTA7VS/Z5kw6lqXQwX/zSjgAdZkXyujtEKgtIDBxFXESdkgLYSjShnkmHIBC90dl9PaG6yVems5vzbDYOheEIWRbMGfqdBm9QnW5xFICriRpG47TguHPRVI/dhSz8eNqr5qVksYs+9bpELCLZtJJnl9qRXFu3RRtsrJnBCcI6gn2PaBSYRBMOpalMGD/bSnxCh8uf5eKjZ7ZVGLv5DFSvilz3qBmtlpirWirzDYNDO/2kFgTKs2XmsQs+0YGHLDKpJMcgWzvg8EU9DZgHJ4nGwi/IHub7ZRJx7IUHPiPkIqBBCwKi5hNqsJ4XslP8vwKwKeMbV1mAyhuYWwN2Snk+Aw7JscY23bpUYzG1HTLtGNZOAPxHyHNGEjA2inUEOoqSn5pDmNrPLfk2cZux7SoFaAw+TSJc2/s3IRd4i4j83BQc0BywdUTO07FM2As045l4QzEf4Q0YyABOynhjLukaGf3oiKfF9JyHbZh69G7ojGxT8F21mbngTQ5loUyEP8R0oyBBOykhANWy+gVjPwk30viDWZ54sFQav9qs5HZxBhKWVAQ/FyyQZhhaQuDTY5lYQzEf4Q0w1nAooexjcS5DvZqkwWToXCJEAXk+8rok9v6osmxzB1n/iMbOwxY39B/xBUMWN/Qf8QVDFjf0H/EFQxY39B/xBUMWN/Qf8Qb9vIu5VeEuCAPXMqnCBk+7JL7hv4jrmDA+ob+I65gwPqG/iOuYMD6hv4jrmDA+ob+I65gwPqG/iOuYMD6hv4jrmDA+ob+I65gwPqG/iOuYMD6hv4jrmDA+ob+I65gwPqG/iOuYMD6hv6bK8+SuBwy9JTMRrrAgPUN/Tc38PD9z0h1N/6BdTPpBAPWN/TfXMAS0qdI/fEfTDh9wID1Df3XG1h77HVB7wy6XkafN8SE0wcMWN/Qf72RL+OciwmnDxiwvqH/eoMJZxEwYH1D//XG7SSupGrFhNM3DFjf0H9zhQmnbxiwvqH/5goTTt8wYH1D/80VJpy+YcD6hv6bK0w4fcOA9Q39N1eYcPqGAesb+m+uMOH0DQPWN/TfXGHC6RsGrG/ov7nChNM3DFjf0H9zhQmnbxwG7N2C7pe0XWbb6HDoP08w4fSNw4A9Sqog+Fpm6wqmsa9KukfNMnAc+o9szDgM2HkknE9L9Z7vyGyDxqH/yMaMw4BlwjE49B/ZmHEYsEw4Bof+IxszAw7YXYJeHvSBoLcEPSPotjI94dwpaE3Q24LODDon6F1BL5JYo7HgPVEMvEaq97wktUGbb9gy8jCJT4U7Leg8icf2pqB9gjY12y2MAfuPkFEGGrCHBv1SqiSgOlviCT4u4Twh6EfJVtLNQc/ZsLXI1YVtrO6dtkPi+WjBbvXJoK3S9gtjoP4jpMwAA/YQGT2ZkVh+lv7+Rdau4IlttxjbdUEnB7096BumHYlsy7iLXBi0XmIiUvuNqQ26V9oOvSS14zMuDvqnoHNNO3Rs2n5hDNB/hIxnYAG7hdQfYP15qYZBd5Q4tLInuE04ONm1/fsSh1bKA40NerqxgUk1HCQnm+T+tm6W9xnblzLb3BmY/wiZzMAC9gCpJ4Yd6uYVcFKr3SacJ0tVe9nbtIP8cZEvrpsnJpxtpXpf6C5180oPSvdFolsoA/MfIZMZWMDa+syVmU15g5QTjgU9pUdKLAqjyPwV6Z5wLFgc7f4Si8QoQqN383NhwiGkGQML2A9JdfJ+JLMpONFLCQfJ4PlBV0i54GzVNuFsL7Ee9AMZfS/7WUw4hExiYAF7klQnLwqzJV4p1TY24bzetENfDDoh6KVBO0m9MNwm4dxH6kXnnwSdFXS0VD0otTHhEDKJgQXsq6R+8m5WN69wqowmHCzxcZNpf2NqV24j9cJvm4RzmLF9V0ZvGD1CmHAIacaSAva5QR82Ql0E5IuRvSy1K+ht/DjZIE04O5o2aPfUrqCeY+2TEs75me10Y/tYZgP20jgTDiGTWFLA2uIwtKuxXWDaUR9ZG7SvxNrNemODNOHgypFtx9AMl8XR80GyuSqzY5hlwaxhtWG+zxkSPxePwrDH+kOJSRHgypft/UA3JNvCWJL/COnGkgJ2UsJBveWbmd3qMvO3reHYyXkQkpVOBMTfdsh1ZNpHebWxWWGmcT6hELL1INR07Gfi9ouFsST/EdKNJQXspIQDMHS6SKrZxXpiHySxUKttNuGgN4LhT36F6vKg3SRe9dI23KZgwX1Qx0nswdh99dYGfCZmLlsbEhgKxquzdnzWwliS/wjpxsAD9g5Be0is0TTtOeB2BCSBPaX9vU0oLt9dYqLBXB4LhmcPCXps0APS66UzcP8RUocB6xv6j7iCAesb+m+u4MLDnfNGMgMMWN/Qf72Dq4+nSLyyqfXAa4OOl/ZDdJLDgPUN/dcruOn321K/CGCFaQ86LYJ0gQHrG/qvN3CR4HtSTzDo2dgpENBXJV5YIF1gwPqG/usNPDpWkwqmPOCJAADJBbfK2KTzgmQjbWHA+ob+6w3c7KsJ5c2ZDQ9/w5Mg1X5i3Uwaw4D1Df3XG3bGOOZa5XxcKvv7MxtpCgPWN/RfL+Ah+e8xwkx3y+2l/uhbPOSfdIEB6xv6byHgkSWabPCEx53rZtIYBqxv6L+5ctegD0q9YHxMbQvSDgasb+i/ufG4oK9LPdngpuOm9/SREgxY39B/vYOnTObLEeHBavvZjUhHGLC+of96BQ9yw1LPNtngUSZb243IDDBgfUP/9Qbm2mDFD5tssLY9VgMhfcGA9Q391xuvlXqy+eu6mfQCA9Y39F8v4GmRP5Uq2eAucdxXNU6Xxt1IaxiwvqH/emG11Hs304TbIEgXGLC+of964S9kNKlMEhNOVxiwvqH/iCsYsL6h/4grGLC+of+IKxiwvqH/iCsYsL6h/4grGLC+of+IKxiwvqH/iCsYsL6h/4grGLC+of+IKxiwvqH/iCsYsL6h/4grNGAp38r9SsggyQOX8qncr4QQQshGy/8DTcJdP95bGjAAAAAASUVORK5CYII="><br>
<!-- -->当我们键入这个可执行文件时，操作系统会先用<em>装载器</em>加载程序，并在合适的时机以进程的形式将其调度到内存中为其分配资源：</p><ul><li>根据&quot;辅助信息&quot;【操作系统进行系统调用】为进程分配设一定的运行时栈，来追踪函数调用、函数参数、局部变量、返回值等</li><li>根据&quot;辅助信息&quot;【操作系统进行系统调用】为进程分配一定的堆内存，来存放运行时动态分配的数据</li><li>【操作系统进行系统调用】根据虚拟内存布局将19、3其放入实际的内存空间</li><li>【操作系统进行系统调用】将指令放入实际的内存空间
当操作系统发现进程可以开始执行时：    </li><li>【操作系统请求系统调用】把 CS:IP 指向 plus 的第一个指令所处的实际内存位置 </li></ul><p>CPU的定时时钟执行：</p><ul><li>【CPU】CS:IP对应的内存地址中拿出这个指令，并且译指为mov   </li><li>【CPU】执行 mov 指令将立即数 013H 装入通用寄存器    </li><li>【CPU】循环，进入下一个 mov 和 add</li></ul><p><img alt="img_6.png" src="/assets/images/img_6-8bcce0e1c88b99f72e94beeb524aae4b.png"></p><p>这里我们要分清物理机和操作系统分别干的事，我们看到物理机干的事相当简单</p><ul><li>根据 CS:IP 取指</li><li>解析指令</li><li>执行指令</li></ul><p>所以当我们实现自己的虚拟机时我们应该有以下组成部分：</p><ul><li>定义：一套自定义指令集</li><li>实现：一套寄存器，来存放数据和状态</li><li>实现：一个运行栈来根据维护函数调用和返回</li><li>实现：一个循环，一直来取指和执行</li></ul><p>如果我们愿意，我们完全可以在JS的环境中写一个虚拟机来执行这段机器码。
JS的的代码</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">const stack = [];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const ops = [];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const = pc;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const p = loader(`BB 23 01 BB 03 00 89 D8 01 D8`)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const op = p[pc];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">while(op) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    swich(op) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        case &#x27;BB&#x27;: // mov </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            pop(p.nextOperaNumber);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        case &#x27;D8&#x27;: // add</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            stack.push(stack.pop() + stack.pop());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pc = op.nextOp;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/7213/my-favorite-code-segment/tree/main/docs/docs/编译原理/虚拟机.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/数学/矩阵"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->矩阵</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/编译原理/一种JS Parser：TDOP/词法和语法"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">词法和语法<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#物理机和操作系统" class="table-of-contents__link toc-highlight">物理机和操作系统</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.76f2abf5.js"></script>
<script src="/assets/js/main.653bb773.js"></script>
</body>
</html>